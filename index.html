<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Fishing Fun</title>
  <base href="https://hackerfrankone.github.io/FamilyFishing/">
  <style>
    body {
      background-image: url('https://hackerfrankone.github.io/FamilyFishing/images/background.jpg?v=1');
      background-color: #000;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
    }
    @media (max-width: 768px) {
      body {
        background-position: center;
      }
    }
    @media (max-width: 480px) {
      body {
        background-position: center;
      }
    }
    a {
      color: #00ffff;
      text-decoration: none;
    }
    .top-bar {
      text-align: center;
      margin-bottom: 2rem;
    }
    .social-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .facebook-button img, .youtube-button img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      transition: filter 0.3s ease;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
    }
    .facebook-button:hover img, .youtube-button:hover img {
      filter: brightness(150%);
    }
    .discord-button, .donate-button, .archive-button, .tackle-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      text-decoration: none;
      transition: filter 0.3s ease;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
    }
    .discord-button {
      background-color: #5865F2;
      color: white;
    }
    .donate-button {
      background-color: #FFD700;
      color: white;
      border: none;
      cursor: pointer;
    }
    .archive-button {
      background-color: #808080;
      color: white;
    }
    .tackle-button {
      background-color: #006400;
      color: white;
    }
    .discord-button:hover, .archive-button:hover, .tackle-button:hover {
      filter: brightness(150%);
    }
    .donate-button:hover {
      filter: brightness(75%);
    }
    .tournament-info {
      display: inline-block;
      background: rgba(0, 0, 0, 0.7);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      margin: 1rem auto 0;
    }
    .tournament-info p {
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      text-align: center;
    }
    .tournament-info .main-text {
      font-size: 1.2rem;
      white-space: nowrap;
    }
    .tournament-info .sub-text {
      font-size: 1rem;
      margin-top: 0.3rem;
    }
    @media (max-width: 768px) {
      .tournament-info {
        padding: 0.4rem 0.8rem;
      }
      .tournament-info .main-text {
        font-size: 1rem;
      }
      .tournament-info .sub-text {
        font-size: 0.9rem;
        margin-top: 0.2rem;
      }
    }
    .countdown {
      font-size: 1rem;
      font-weight: bold;
      max-width: 600px;
      margin: 0.5rem auto 0;
      text-align: center;
      color: #FFD140;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    .countdown-red {
      color: red !important;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    .feedback {
      font-size: 0.9rem;
      text-align: center;
      margin-top: 1rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    .feedback a {
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    .button-group {
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    .submit-button {
      background-color: #28a745;
      color: white;
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      display: inline-block;
      width: auto;
      max-width: 90vw;
      text-decoration: none;
    }
    .paypal-form {
      display: grid;
      justify-items: center;
      gap: 0.5rem;
    }
    .paypal-button {
      background-color: #FFD700;
      color: #000;
      font-weight: bold;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      padding: 10px 2rem;
      cursor: pointer;
      transition: filter 0.3s ease;
    }
    .paypal-button:hover {
      filter: brightness(150%);
    }
    .leaderboard {
      text-align: center;
      margin-bottom: 1rem;
    }
    .leaderboard img {
      max-width: 200px;
      width: 100%;
      height: auto;
      border-radius: 8px;
    }
    .identifier-container {
      position: absolute;
      top: 1rem; /* Adjusted from 15rem to 1rem to take the top-left spot */
      left: 1rem;
      z-index: 1000;
    }
    .identifier-container .month-identifier {
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      margin: 0.2rem 0;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: bold;
      color: #FFA500 !important;
      font-size: 1rem;
    }
    .angler-sidebar {
      position: fixed;
      top: 4rem; /* Adjusted from 16.5rem to 4rem to avoid overlap with identifier */
      left: 1rem;
      background: rgba(0, 0, 0, 0.6);
      padding: 1rem;
      border-radius: 8px;
      max-width: 200px;
      z-index: 1000;
    }
    .angler-sidebar h3 {
      color: yellow;
      font-weight: bold;
      font-family: 'Arial', sans-serif;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      margin: 0 0 0.5rem;
      font-size: 1.2rem;
    }
    .angler-sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 300px;
      overflow-y: auto;
    }
    .angler-sidebar ul::-webkit-scrollbar {
      width: 8px;
    }
    .angler-sidebar ul::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }
    .angler-sidebar ul::-webkit-scrollbar-thumb {
      background: yellow;
      border-radius: 4px;
    }
    .angler-sidebar ul::-webkit-scrollbar-thumb:hover {
      background: #FFD140;
    }
    .angler-sidebar li {
      color: yellow;
      font-weight: bold;
      font-family: 'Arial', sans-serif;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    .submit-footer {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      z-index: 9999;
    }
    @media (max-width: 768px) {
      .button-group {
        flex-direction: column;
        align-items: center;
      }
      .countdown {
        font-size: 0.9rem;
      }
      .identifier-container {
        position: static;
        margin: 1rem auto;
        max-width: 100%;
        text-align: center;
      }
      .angler-sidebar {
        position: static;
        margin: 1rem auto;
        max-width: 100%;
        text-align: center;
      }
      .submit-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
        bottom: 0.5rem;
        left: 0.5rem;
      }
      .identifier-container .month-identifier {
        color: #FFA500 !important;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }
    }
    .submit-fish-button {
      background-color: #FFA500;
      transition: filter 0.3s ease;
    }
    .submit-fish-button:hover {
      filter: brightness(75%);
    }
    .leaderboard-title, .current-winner-title {
      color: yellow;
      font-weight: bold;
      font-family: 'Arial', sans-serif;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      margin-top: 0.5rem;
    }
    .current-leaderboard-title {
      color: yellow;
      font-weight: bold;
      font-family: Arial, Helvetica, sans-serif;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      background: rgba(0, 0, 0, 0.7);
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      display: inline-block;
    }
    .leaderboard-container {
      text-align: center;
      margin-top: 2rem;
    }
    .leaderboard-container img {
      display: block;
      margin: 0 auto;
      max-width: 350px;
      height: auto;
      border-radius: 8px;
    }
    .leaderboard-container .no-image-text {
      display: block;
      margin: 0 auto;
      max-width: 350px;
      font-size: 1.5rem;
      font-weight: bold;
      color: #FFD140;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      text-align: center;
    }
    .small-button {
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 6px;
    }
    :root {
      --primary-color: #FFA500;
    }
    .identifier-container .month-identifier {
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      margin: 0.2rem 0;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: bold;
      color: var(--primary-color) !important;
      font-size: 1rem;
    }
    .submit-fish-button {
      background-color: var(--primary-color);
      transition: filter 0.3s ease;
    }
    @media (max-width: 768px) {
      .identifier-container .month-identifier {
        color: var(--primary-color) !important;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }
    }
    .rules-button {
      background-color: #cc0000;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }
    .rules-button:hover {
      background-color: #ff0000;
    }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
    style-src 'self' 'unsafe-inline';
    img-src 'self' https://hackerfrankone.github.io https://www.paypalobjects.com https://upload.wikimedia.org https://www.google.com https://www.gstatic.com data:;
    connect-src 'self' https://worldtimeapi.org https://www.google-analytics.com https://api.github.com https://raw.githubusercontent.com;
    frame-ancestors 'none';
    form-action 'self' https://www.paypal.com;
    object-src 'none';
    base-uri 'self';
  ">
  <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="Referrer-Policy" content="no-referrer">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBHYE2X44" onload="console.log('Google Analytics script loaded');" onerror="console.log('Google Analytics script failed to load');"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-6EBHYE2X44', { 'anonymize_ip': true });
  </script>
  <link rel="icon" href="images/favicon.jpg" type="image/jpg">
</head>
<body>
  <div class="identifier-container">
    <p id="monthly-identifier" class="month-identifier">
      <span id="month"></span> Identifier: <span id="month-code"></span>
    </p>
  </div>
  <div class="angler-sidebar">
    <h3>ANGLERS</h3>
    <ul id="angler-list">
      <li>Loading...</li>
    </ul>
  </div>
  <div class="top-bar">
    <div class="social-buttons">
      <form action="https://www.paypal.com/donate" method="post" target="_blank" rel="noopener">
        <input type="hidden" name="marketplace" value="US" />
        <input type="hidden" name="hosted_button_id" value="AVS6RRJQXPTDS" />
        <button type="submit" class="donate-button">Donate</button>
      </form>
      <a href="pages/tackle.html" target="_blank" rel="noopener noreferrer" class="tackle-button" aria-label="Visit our Tackle">Tackle</a>
      <a href="https://www.facebook.com/share/g/18orZuMkch/" target="_blank" rel="noopener noreferrer" class="facebook-button" aria-label="Visit our Facebook page">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook logo">
      </a>
      <a href="https://www.youtube.com/@usafamilyfishingfun" target="_blank" rel="noopener noreferrer" class="youtube-button" aria-label="Visit our YouTube channel">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" alt="YouTube logo">
      </a>
      <a href="https://discord.gg/SWxsq4q8wH" target="_blank" rel="noopener noreferrer" class="discord-button" aria-label="Join our Discord server">Discord</a>
      <a href="pages/archive.html" target="_blank" rel="noopener noreferrer" class="archive-button" aria-label="View our archive">Archive</a>
    </div>
    <div class="tournament-info">
      <p class="main-text">
        The longest bass wins $100 Bass Pro Shop gift card!
      </p>
      <p class="main-text">
        Month long kayak tournament
      </p>
      <p class="main-text">
        More anglers | More payout
      </p>
      <p class="sub-text">
        Tennessee Lakes Only
      </p>
    </div>
    <p class="feedback">
      Feedback or questions: <a href="mailto:usa@familyfishing.fun" rel="noopener">usa@familyfishing.fun</a>
    </p>
  </div>
  <p class="countdown" id="countdown">
    Tournament ends in: <span id="countdown-timer">Calculating...</span>
  </p>
  <div class="button-group">
    <a href="PDFs/rules.pdf" target="_blank" rel="noopener" class="submit-button small-button rules-button">ðŸ“„ Rules</a>
    <form action="https://www.paypal.com/ncp/payment/MQGR2KDA2VZP4" method="post" target="_blank" rel="noopener" class="paypal-form">
      <input type="hidden" name="custom" value="tournament-join" />
      <input type="submit" value="Join Tournament $20" class="paypal-button" />
      <img src="https://www.paypalobjects.com/images/Debit_Credit_APM.svg" alt="Accepted payment methods" />
      <section style="font-size: 0.75rem;">
        Powered by <img src="https://www.paypalobjects.com/paypal-ui/logos/svg/paypal-wordmark-color.svg" alt="PayPal logo" style="height:0.875rem; vertical-align:middle;" />
      </section>
    </form>
  </div>
  <div class="leaderboard-container">
    <div class="current-leaderboard-title"><strong id="biggest-bass-title">Biggest Bass (Updates: Mon. Wed. Fri.)</strong></div>
    <img id="leaderboard-image" src="images/current/bass_may_2025.jpg" alt="Current Month Leaderboard" style="max-width: 350px; height: auto; border-radius: 8px;" onload="console.log('Current Month Leaderboard image loaded:', this.src);" onerror="handleImageError(this);">
    <div class="current-winner-title"><strong id="current-winner-name">Loading...</strong></div>
  </div>
  <div class="submit-footer">
    <a href="https://www.dropbox.com/request/YwG0NvsfxiLX9Ciiypcy" target="_blank" rel="noopener noreferrer" class="submit-button submit-fish-button">ðŸ“¸ Submit Fish</a>
  </div>
  <script>
    console.log('JavaScript executed: Page load started');
    const monthCodes = ["January", "February", "March", "April", "May", "June",
                        "July", "August", "September", "October", "November", "December"];

    function mulberry32(seed) {
      return function() {
        let t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }

    function generateSeededCode(seed, useSeed = true) {
      const random = useSeed ? mulberry32(seed) : Math.random;
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 3; i++) {
        code += letters.charAt(Math.floor(random() * letters.length));
      }
      console.log(`Generated Identifier Code: ${code}`);
      return code;
    }

    async function fetchCurrentTime() {
      const cachedTime = localStorage.getItem('serverTime');
      const cacheTimestamp = localStorage.getItem('serverTimeTimestamp');
      const cacheAge = cacheTimestamp ? Date.now() - parseInt(cacheTimestamp) : Infinity;
      if (cachedTime && cacheAge < 3600000) { // Cache for 1 hour
        console.log('Using cached server time');
        return new Date(cachedTime);
      }
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5s timeout
        const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC', { signal: controller.signal });
        clearTimeout(timeoutId);
        const data = await response.json();
        const serverTime = new Date(data.utc_datetime);
        localStorage.setItem('serverTime', serverTime.toISOString());
        localStorage.setItem('serverTimeTimestamp', Date.now().toString());
        console.log('Fetched new server time');
        return serverTime;
      } catch (error) {
        console.error('Error fetching time, using local time:', error);
        return new Date();
      }
    }

    async function fetchWithRetry(url, maxRetries = 3, timeout = 5000) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), timeout);
          const response = await fetch(url, { signal: controller.signal, cache: 'no-store' });
          clearTimeout(timeoutId);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          console.log(`Fetch successful: ${url}`);
          return response;
        } catch (error) {
          console.error(`Fetch attempt ${i + 1} failed for ${url}:`, error);
          if (i === maxRetries - 1) throw error;
        }
      }
    }

    async function loadCurrentWinner() {
      console.log('loadCurrentWinner started');
      const winnerElement = document.getElementById("current-winner-name");
      if (!winnerElement) {
        console.error('DOM element not found: current-winner-name');
        return;
      }
      try {
        const response = await fetchWithRetry('https://raw.githubusercontent.com/hackerfrankone/FamilyFishing/main/images/current/current_winner');
        const text = await response.text();
        const winnerName = text.trim() || 'No winner yet';
        console.log('Current winner:', winnerName);
        winnerElement.textContent = `Current Winner: ${winnerName}`;
        // Store the current winner data in localStorage for archiving later
        const today = await fetchCurrentTime();
        const monthNumber = today.getMonth();
        const year = today.getFullYear();
        const monthCode = monthCodes[monthNumber];
        const currentWinnerData = {
          month: `${monthCode} ${year}`,
          angler: winnerName,
          image: `images/current/bass_${monthCode.toLowerCase()}_${year}.jpg`
        };
        localStorage.setItem('currentWinner', JSON.stringify(currentWinnerData));
      } catch (error) {
        console.error('Error loading current winner:', error);
        winnerElement.textContent = 'No winner yet';
      }
    }

    async function checkAndArchivePreviousWinner(today, monthNumber, year) {
      const lastMonthDate = new Date(year, monthNumber - 1, 1);
      const lastMonthCode = monthCodes[lastMonthDate.getMonth()];
      const lastMonthYear = lastMonthDate.getFullYear();
      const lastMonth = `${lastMonthCode} ${lastMonthYear}`;
      const currentWinnerData = JSON.parse(localStorage.getItem('currentWinner') || '{}');
      const storedMonthYear = localStorage.getItem('monthYear');

      if (storedMonthYear !== `${year}-${monthNumber}` && currentWinnerData.month === lastMonth) {
        const winner = currentWinnerData.angler;
        const winnerImage = currentWinnerData.image;
        let archiveData = [];
        try {
          const response = await fetchWithRetry('https://raw.githubusercontent.com/hackerfrankone/FamilyFishing/main/images/archive/archive.json');
          if (response.ok) {
            archiveData = await response.json();
          }
        } catch (error) {
          console.error('Error fetching archive.json for update:', error);
        }

        const lastMonthEntry = archiveData.find(item => item.month === lastMonth);
        if (!lastMonthEntry) {
          archiveData.push({ month: lastMonth, angler: winner, image: winnerImage });
          const newArchiveContent = JSON.stringify(archiveData, null, 2);
          const encodedContent = encodeURIComponent(newArchiveContent);
          const commitMessage = encodeURIComponent(`Add ${lastMonth} winner to archive.json`);
          const commitUrl = `https://github.com/hackerfrankone/FamilyFishing/edit/main/images/archive/archive.json?message=${commitMessage}&value=${encodedContent}`;
          console.log(`Please update archive.json with: ${newArchiveContent} via ${commitUrl}`);
        }
      }
    }

    let isUpdatingMonth = false;

    async function updateMonth() {
      if (isUpdatingMonth) {
        console.log('updateMonth already running, skipping');
        return;
      }
      isUpdatingMonth = true;
      console.log('updateMonth function started');
      try {
        const today = await fetchCurrentTime();
        const monthNumber = today.getMonth();
        const year = today.getFullYear();
        const monthCode = monthCodes[monthNumber];
        const currentMonthYear = `${year}-${monthNumber}`;
        const storedMonthYear = localStorage.getItem('monthYear');
        if (storedMonthYear !== currentMonthYear) {
          localStorage.setItem('monthYear', currentMonthYear);
          await checkAndArchivePreviousWinner(today, monthNumber, year);
        }
        let randomCode;
        if (year === 2025 && monthNumber === 3) {
          randomCode = 'IKY';
        } else if (year > 2025 || (year === 2025 && monthNumber >= 4)) {
          const seed = parseInt(`${year}${monthNumber.toString().padStart(2, '0')}`);
          randomCode = generateSeededCode(seed, true);
        } else {
          randomCode = generateSeededCode(0, false);
        }
        const monthElement = document.getElementById("month");
        const codeElement = document.getElementById("month-code");
        const biggestBassTitle = document.getElementById("biggest-bass-title");
        const leaderboardImage = document.getElementById("leaderboard-image");
        const currentWinnerElement = document.getElementById("current-winner-name");
        if (monthElement && codeElement && biggestBassTitle && leaderboardImage && currentWinnerElement) {
          monthElement.textContent = monthCode;
          codeElement.textContent = randomCode;
          biggestBassTitle.textContent = `${monthCode}'s Biggest Bass (Updates: Mon. Wed. Fri.)`;
          const currentBassImageSrc = `images/current/bass_${monthCode.toLowerCase()}_${year}.jpg?v=1`;
          console.log(`Setting current bass image src: ${currentBassImageSrc}`);
          leaderboardImage.src = currentBassImageSrc;
          currentWinnerElement.textContent = `Current Winner: Loading...`; // Reset winner name
        } else {
          console.error('DOM elements not found for updateMonth');
        }
      } catch (error) {
        console.error('Error in updateMonth:', error);
      } finally {
        isUpdatingMonth = false;
        console.log('updateMonth function completed');
      }
    }

    function handleImageError(imgElement) {
      const leaderboardContainer = imgElement.parentElement;
      const noImageText = document.createElement('div');
      noImageText.className = 'no-image-text';
      noImageText.textContent = 'Family Fishing Fun';
      leaderboardContainer.replaceChild(noImageText, imgElement);
      console.log('Image failed to load, replaced with "Family Fishing Fun" text');
    }

    let serverTimeOffset = 0;
    let countdownInterval = null;

    async function initializeCountdown() {
      console.log('initializeCountdown started');
      try {
        const serverTime = await fetchCurrentTime();
        serverTimeOffset = serverTime.getTime() - Date.now();
        updateCountdown();
      } catch (error) {
        console.error('Error initializing countdown:', error);
        if (countdownInterval) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          console.log('Countdown interval stopped due to error');
        }
        updateCountdown();
      }
    }

    function updateCountdown() {
      try {
        const now = new Date(Date.now() + serverTimeOffset);
        const year = now.getFullYear();
        const month = now.getMonth();
        const target = new Date(Date.UTC(year, month + 1, 1, 0, 0, 0));
        const timeDiff = target - now;
        const timerElement = document.getElementById("countdown-timer");
        const countdownElement = document.getElementById("countdown");
        if (!timerElement || !countdownElement) {
          console.error('DOM element not found: countdown-timer or countdown');
          return;
        }
        if (timeDiff <= 0) {
          updateMonth();
          timerElement.textContent = "Tournament ended!";
          countdownElement.classList.remove('countdown-red');
          if (countdownInterval) {
            clearInterval(countdownInterval);
            countdownInterval = null;
            console.log('Countdown interval stopped; tournament ended');
          }
          return;
        }
        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
        timerElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        if (days <= 3) {
          countdownElement.classList.add('countdown-red');
        } else {
          countdownElement.classList.remove('countdown-red');
        }
      } catch (error) {
        console.error('Error in updateCountdown:', error);
        if (countdownInterval) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          console.log('Countdown interval stopped due to error');
        }
      }
    }

    function startCountdown() {
      if (!countdownInterval) {
        console.log('Starting countdown interval');
        countdownInterval = setInterval(updateCountdown, 2000); // Update every 2 seconds
      }
    }

    function loadAnglerList() {
      console.log('loadAnglerList started');
      const timestamp = new Date().getTime();
      const csvFilePath = `https://raw.githubusercontent.com/hackerfrankone/FamilyFishing/main/CSV/angler_list.csv?cachebust=${timestamp}`;
      fetchWithRetry(csvFilePath)
        .then(response => response.text())
        .then(text => {
          console.log('CSV content:', text);
          const anglerList = document.getElementById("angler-list");
          if (!anglerList) {
            console.error('DOM element not found: angler-list');
            return;
          }
          const lines = text.split('\n').filter(line => line.trim() !== '');
          console.log('Number of lines in CSV:', lines.length);
          if (lines.length === 0) {
            anglerList.innerHTML = '<li>No anglers found.</li>';
            return;
          }
          const anglerNames = lines
            .map(line => {
              const name = line.split(',')[0]?.trim();
              return name ? `<li>${name}</li>` : null;
            })
            .filter(item => item !== null)
            .join('');
          console.log('Processed angler names:', anglerNames);
          anglerList.innerHTML = anglerNames || '<li>No anglers found.</li>';
        })
        .catch(error => {
          console.error('Error loading angler list:', error);
          const anglerList = document.getElementById("angler-list");
          if (anglerList) {
            anglerList.innerHTML = '<li>Failed to load anglers. Fallback: John Doe, Jane Smith</li>';
          }
        });
    }

    window.onload = function() {
      console.log('Page fully loaded (window.onload triggered)');
    };

    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM fully loaded');
      updateMonth();
      initializeCountdown();
      startCountdown();
      loadAnglerList();
      loadCurrentWinner();
      setInterval(updateMonth, 48 * 60 * 60 * 1000); // Run every 48 hours
      console.log('Page initialization complete');
    });
  </script>
</body>
</html>
