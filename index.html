<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Fishing Fun</title>

  <!-- Meta & Security Headers -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'none';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="Referrer-Policy" content="no-referrer">
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBHYE2X44"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-6EBHYE2X44');
  </script>

  <!-- Favicon -->
  <link rel="icon" href="favicon.png" type="image/png">

  <!-- Styles -->
  <style>
    body {
      background: url('background.jpg') no-repeat center top fixed;
      background-size: cover;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
    }
    a { color: #00ffff; text-decoration: none; }
    .top-bar { text-align: center; margin-bottom: 2rem; }
    .social-buttons {
      display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;
    }
    .facebook-button img, .youtube-button img {
      width: 50px; height: 50px; border-radius: 50%;
    }
    .discord-button {
      padding: 10px 16px; font-size: 16px; border-radius: 6px; text-decoration: none;
      display: inline-flex; align-items: center; justify-content: center;
      color: white; background-color: #1877F2;
    }
    .subtitle { font-size: 1rem; max-width: 600px; margin: 1rem auto 0; text-align: center; }
    .countdown {
      font-size: 1rem;
      font-weight: bold;
      max-width: 600px;
      margin: 0.5rem auto 0;
      text-align: center;
      color: #FFD140; /* Matches PayPal button for visual consistency */
    }
    .feedback { font-size: 0.9rem; text-align: center; margin-top: 1rem; }
    .button-group {
      display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 2rem;
    }
    .submit-button {
      background-color: #28a745; color: white; padding: 8px 16px;
      font-size: 14px; border: none; border-radius: 8px; cursor: pointer;
      text-align: center; display: inline-block; width: auto; max-width: 90vw; text-decoration: none;
    }
    .paypal-form { display: grid; justify-items: center; gap: 0.5rem; }
    .paypal-button {
      background-color: #FFD140; color: #000; font-weight: bold; font-size: 1rem;
      border: none; border-radius: 6px; padding: 10px 2rem; cursor: pointer;
    }
    .leaderboard { text-align: center; margin-bottom: 1rem; }
    .leaderboard img { max-width: 200px; width: 100%; height: auto; border-radius: 8px; }
    .ads {
      position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
      z-index: 1000;
    }
    @media (max-width: 768px) {
      .button-group { flex-direction: column; align-items: center; }
      .countdown { font-size: 0.9rem; }
    }
    .submit-fish-button { background-color: #FFA500; }
    .chickamauga-title, .watts-bar-title, .angler-name {
      color: yellow;
      font-weight: bold;
      font-family: 'Arial', sans-serif;
    }
    .small-button {
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 6px;
    }
    .rules-button {
      background-color: #cc0000;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.3s ease;
    }
    .rules-button:hover { background-color: #ff0000; }
  </style>
</head>
<body>

  <!-- Top Section -->
  <div class="top-bar">
    <div class="social-buttons">
      <!-- Donate -->
      <form action="https://www.paypal.com/donate" method="post" target="_top">
        <input type="hidden" name="hosted_button_id" value="AVS6RRJQXPTDS" />
        <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Donate" />
      </form>

      <!-- Facebook -->
      <a href="https://www.facebook.com/share/g/18orZuMkch/" target="_blank" class="facebook-button" aria-label="Facebook">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook">
      </a>

      <!-- YouTube -->
      <a href="https://www.youtube.com/@usafamilyfishingfun" target="_blank" class="youtube-button" aria-label="YouTube">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" alt="YouTube">
      </a>

      <!-- Discord -->
      <a href="https://discord.gg/SWxsq4q8wH" target="_blank" class="discord-button" aria-label="Discord">
        Join us on Discord
      </a>
    </div>

    <!-- Tournament Subtitle -->
    <p class="subtitle">
      Month long kayak tournament. The longest bass wins $100 Bass Pro Shop gift card!
    </p>

    <!-- Countdown Timer -->
    <p class="countdown" id="countdown">
      Tournament ends in: <span id="countdown-timer">Calculating...</span>
    </p>

    <!-- Feedback Section -->
    <p class="feedback">
      Feedback or questions: <a href="mailto:usa@familyfishing.fun">usa@familyfishing.fun</a>
    </p>
  </div>

  <!-- Buttons -->
  <div class="button-group">
    <a href="Rules.pdf" target="_blank" class="submit-button small-button rules-button">ðŸ“„ Rules</a>

    <!-- Join Tournament PayPal -->
    <form action="https://www.paypal.com/ncp/payment/MQGR2KDA2VZP4" method="post" target="_blank" class="paypal-form">
      <input type="submit" value="Join Tournament $20" class="paypal-button" />
      <img src="https://www.paypalobjects.com/images/Debit_Credit_APM.svg" alt="cards" />
      <section style="font-size: 0.75rem;">
        Powered by <img src="https://www.paypalobjects.com/paypal-ui/logos/svg/paypal-wordmark-color.svg" alt="paypal" style="height:0.875rem; vertical-align:middle;" />
      </section>
    </form>
  </div>

  <!-- Leaderboards Side by Side -->
  <div style="display: flex; justify-content: space-between; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
    <!-- Chickamauga -->
    <div style="flex: 1; min-width: 250px; text-align: left;">
      <div class="chickamauga-title"><strong>Chickamauga's Biggest Bass</strong></div>
      <img src="testing.jpg" alt="Chickamauga Leader Board" style="max-width: 300px; height: auto; border-radius: 8px;">
      <p class="angler-name"><em>Angler's name</em></p>
    </div>

    <!-- Watts Bar -->
    <div style="flex: 1; min-width: 250px; text-align: right;">
      <div class="watts-bar-title"><strong>Watts Bar's Biggest Bass</strong></div>
      <img src="testing.jpg" alt="Watts Bar Leader Board" style="max-width: 300px; height: auto; border-radius: 8px;">
      <p class="angler-name"><em>Angler's name</em></p>
    </div>
  </div>

  <!-- Submit Fish and Monthly Identifier -->
  <div style="position: fixed; bottom: -20px; left: 50%; transform: translateX(-50%); text-align: center; z-index: 9999; width: 100%;">
    <a href="https://www.dropbox.com/request/YwG0NvsfxiLX9Ciiypcy" target="_blank" class="submit-button submit-fish-button">ðŸ“¸ Submit Fish</a>
    <p id="monthly-identifier" class="month-identifier" style="margin-top: 1rem; margin-bottom: 2rem;">
      <span id="month"></span> Identifier: <span id="month-code"></span>
    </p>
  </div>

  <!-- Dynamic Month and Countdown Script -->
  <script>
    // Months
    const monthCodes = ["January", "February", "March", "April", "May", "June",
                        "July", "August", "September", "October", "November", "December"];

    function generateRandomCode() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 3; i++) {
        code += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      return code;
    }

    async function fetchCurrentTime() {
      try {
        const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC');
        const data = await response.json();
        return new Date(data.utc_datetime);
      } catch (error) {
        console.error('Error fetching time:', error);
        return new Date(); // Fallback to client time if API fails
      }
    }

    async function updateMonth() {
      const today = await fetchCurrentTime();
      const monthNumber = today.getMonth();
      const year = today.getFullYear();
      const monthCode = monthCodes[monthNumber];
      const currentMonthYear = `${year}-${monthNumber}`;

      // Check localStorage for existing code
      const storedMonthYear = localStorage.getItem('monthYear');
      let randomCode = localStorage.getItem('randomCode');

      // If the stored month/year doesn't match or no code exists, generate a new code
      if (storedMonthYear !== currentMonthYear || !randomCode) {
        randomCode = generateRandomCode();
        localStorage.setItem('monthYear', currentMonthYear);
        localStorage.setItem('randomCode', randomCode);
      }

      // Update the DOM
      document.getElementById("month").textContent = monthCode;
      document.getElementById("month-code").textContent = randomCode;
    }

    async function updateCountdown() {
      const now = await fetchCurrentTime();
      const year = now.getFullYear();
      const month = now.getMonth();
      // Set target to the first day of the next month at 00:00:00 UTC
      const target = new Date(Date.UTC(year, month + 1, 1, 0, 0, 0));
      
      const timeDiff = target - now;
      if (timeDiff <= 0) {
        // Month has ended, update month and reset countdown
        updateMonth();
        document.getElementById("countdown-timer").textContent = "Tournament ended!";
        return;
      }

      const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

      document.getElementById("countdown-timer").textContent = 
        `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    // Update month immediately when page loads
    updateMonth();

    // Update countdown immediately and every second
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // Check for month change every 24 hours
    setInterval(updateMonth, 24 * 60 * 60 * 1000);
  </script>

  <!-- AdSense Ad -->
  <div class="ads">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9237571676231200" crossorigin="anonymous"></script>
    <ins class="adsbygoogle" style="display:inline-block;width:300px;height:100px"
      data-ad-client="ca-pub-9237571676231200"
      data-ad-slot="7591272404"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

</body>
</html>
